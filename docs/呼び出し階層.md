# RotateScreen é–¢æ•°å‘¼ã³å‡ºã—éšå±¤

| é E›® | å€¤ |
|------|-----|
| ãƒãEã‚¸ãƒ§ãƒ³ | v1.3.1 |
| ãƒªãƒ“ã‚¸ãƒ§ãƒ³ | bff54a9 |
| æ›´æ–°æ—¥ | 2025-12-10 |

åE‚³ãƒ³ãƒãEãƒãƒ³ãƒˆãEé–¢æ•°å‘¼ã³å‡ºã—éšå±¤ã‚’å›³ç¤ºã—ã¾ã™ã€E

---

## ç›®æ¬¡

1. [Content Script (content/index.js)](#content-script)
2. [AI Detector (content/ai-detector.js)](#ai-detector)
3. [Face Detector (content/face-detector.js)](#face-detector)
4. [Background Service Worker (background/service-worker.js)](#background-service-worker)
5. [Popup (popup/popup.js)](#popup)
6. [Options (options/options.js)](#options)
7. [Settings Manager (storage/settings-manager.js)](#settings-manager)
8. [ã‚³ãƒ³ãƒãEãƒãƒ³ãƒˆé–“é€šä¿¡](#ã‚³ãƒ³ãƒãEãƒãƒ³ãƒˆé–“é€šä¿¡)

---

## Content Script

### ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒE

```
initialize()                          â†EãƒšãEã‚¸èª­ã¿è¾¼ã¿æ™‚ã«è‡ªå‹•å®Ÿè¡E
â”œâ”€â”€ isYouTube()                       # YouTubeãƒšãEã‚¸ã‹åˆ¤å®E
â”œâ”€â”€ loadSettings()                    # è¨­å®šã‚’èª­ã¿è¾¼ã¿
â”E  â””â”€â”€ chrome.storage.local.get()
â”œâ”€â”€ waitForPlayer()                   # ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æº–å‚™å¾E©E
â”E  â””â”€â”€ isPlayerReady()
â”E      â”œâ”€â”€ detectPlayer()
â”E      â””â”€â”€ detectVideo()
â”œâ”€â”€ setupRotation()                   # å›è»¢æ©ŸèEã‚»ãƒEƒˆã‚¢ãƒEE
â”E  â”œâ”€â”€ injectUI()                    # UIã‚’æ³¨å…¥
â”E  â”E  â”œâ”€â”€ injectControlbarUI()      # ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒãEã«é…ç½®
â”E  â”E  â”E  â”œâ”€â”€ removeExistingButton()
â”E  â”E  â”E  â”œâ”€â”€ createRotateButton()
â”E  â”E  â”E  â””â”€â”€ updateButtonState()
â”E  â”E  â””â”€â”€ injectOverlayUI()         # ã‚ªãƒ¼ãƒãEãƒ¬ã‚¤ã«é…ç½®
â”E  â”E      â”œâ”€â”€ removeExistingButton()
â”E  â”E      â”œâ”€â”€ detectVideoContainer()
â”E  â”E      â”œâ”€â”€ detectPlayer()
â”E  â”E      â”œâ”€â”€ createRotateButton()
â”E  â”E      â””â”€â”€ updateButtonState()
â”E  â”œâ”€â”€ getCurrentVideoId()
â”E  â”E  â””â”€â”€ extractVideoId()
â”E  â”œâ”€â”€ loadVideoRotation()           # ä¿å­˜æ¸ˆã¿å›è»¢ã‚’èª­ã¿è¾¼ã¿
â”E  â”E  â””â”€â”€ chrome.storage.local.get()
â”E  â”œâ”€â”€ setRotation()                 # å›è»¢ã‚’é©ç”¨
â”E  â”E  â”œâ”€â”€ isValidRotation()
â”E  â”E  â”œâ”€â”€ detectVideo()
â”E  â”E  â”œâ”€â”€ removeRotationClasses()
â”E  â”E  â””â”€â”€ updateButtonState()
â”E  â””â”€â”€ tryAutoRotation()             # è‡ªå‹•å›è»¢æ¤œåEEˆæœ‰åŠ¹æ™‚ï¼E
â”E      â”œâ”€â”€ isLiveStream()            # ãƒ©ã‚¤ãƒ–éEä¿¡ãƒã‚§ãƒE‚¯
â”E      â”œâ”€â”€ tryAIDetection()          # AIåˆ¤å®šï¼EetectionMethod === 'ai'ã®å ´åˆï¼E
â”E      â”E  â””â”€â”€ window.RotateScreenAIDetector.detectVideoOrientation()
â”E      â””â”€â”€ tryFaceDetection()        # é¡”æ¤œåEEEetectionMethod === 'face'ã®å ´åˆï¼E
â”E          â””â”€â”€ window.RotateScreenFaceDetector.detectVideoOrientation()
â”E              â””â”€â”€ showAutoRotationNotification()
â”œâ”€â”€ document.addEventListener('keydown', handleKeyDown)
â”œâ”€â”€ document.addEventListener('fullscreenchange', handleFullscreenChange)
â””â”€â”€ observeVideoChange()              # å‹•ç”»åˆE‚Šæ›¿ãˆç›£è¦–é–‹å§E
```

### ã‚­ãƒ¼ãƒœãEãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒEƒˆå‡¦çE

```
handleKeyDown(event)                  â†Ekeydownã‚¤ãƒ™ãƒ³ãƒE
â”œâ”€â”€ isInputFocused()                  # å…¥åŠ›æ¬Eƒ•ã‚©ãƒ¼ã‚«ã‚¹åˆ¤å®E
â”œâ”€â”€ matchesHotkey()                   # ãƒ›ãƒƒãƒˆã‚­ãƒ¼ä¸€è‡´åˆ¤å®E
â””â”€â”€ handleRotate()                    # å›è»¢å®Ÿè¡E
    â”œâ”€â”€ rotateNext()
    â”E  â”œâ”€â”€ getNextRotation()
    â”E  â””â”€â”€ setRotation()
    â”E      â”œâ”€â”€ isValidRotation()
    â”E      â”œâ”€â”€ detectVideo()
    â”E      â”œâ”€â”€ removeRotationClasses()
    â”E      â””â”€â”€ updateButtonState()
    â”œâ”€â”€ getCurrentVideoId()
    â”E  â””â”€â”€ extractVideoId()
    â””â”€â”€ saveVideoRotation()           # å›è»¢çŠ¶æ…‹ã‚’ä¿å­E
        â””â”€â”€ chrome.storage.local.set()
```

### ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒE‚¯å‡¦çE

```
button.click                          â†Eãƒœã‚¿ãƒ³ã‚¯ãƒªãƒE‚¯ã‚¤ãƒ™ãƒ³ãƒE
â””â”€â”€ handleRotate()
    â”œâ”€â”€ rotateNext()
    â”E  â”œâ”€â”€ getNextRotation()
    â”E  â””â”€â”€ setRotation()
    â”œâ”€â”€ getCurrentVideoId()
    â””â”€â”€ saveVideoRotation()

button.dblclick                       â†Eãƒœã‚¿ãƒ³ãƒ€ãƒ–ãƒ«ã‚¯ãƒªãƒE‚¯ã‚¤ãƒ™ãƒ³ãƒE
â””â”€â”€ resetRotation()
    â””â”€â”€ setRotation(0)
```

### ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³å¤‰æ›´å‡¦çE

```
handleFullscreenChange()              â†Efullscreenchangeã‚¤ãƒ™ãƒ³ãƒE
â””â”€â”€ setRotation(currentRotation)      # 100mséE»¶å¾Œã«å†é©ç”¨
    â”œâ”€â”€ isValidRotation()
    â”œâ”€â”€ detectVideo()
    â”œâ”€â”€ removeRotationClasses()
    â””â”€â”€ updateButtonState()
```

### å‹•ç”»åˆE‚Šæ›¿ãˆç›£è¦E

```
observeVideoChange()
â””â”€â”€ MutationObserver callback
    â”œâ”€â”€ getCurrentVideoId()
    â”E  â””â”€â”€ extractVideoId()
    â”œâ”€â”€ removeRotationClasses()       # ãƒªã‚»ãƒEƒˆæ™E
    â”œâ”€â”€ waitForPlayer()
    â””â”€â”€ setupRotation()               # æ–°å‹•ç”»ç”¨ã«ã‚»ãƒEƒˆã‚¢ãƒEE
        â””â”€â”€ tryAutoRotation()         # è‡ªå‹•å›è»¢ã‚‚åEè©¦è¡E
```

---

## AI Detector

### AIåˆ¤å®šãƒ¡ã‚¤ãƒ³å‡¦çE

```
detectVideoOrientation(video, options)    â†EContent Scriptã‹ã‚‰å‘¼ã³å‡ºãE
â”œâ”€â”€ captureFrame(video, maxSize)          # å‹•ç”»ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’ã‚­ãƒ£ãƒ—ãƒãƒ£
â”E  â”œâ”€â”€ canvas.getContext('2d')
â”E  â”œâ”€â”€ ctx.drawImage()
â”E  â””â”€â”€ canvas.toDataURL('image/jpeg')
â””â”€â”€ detectOrientationByAI(imageData)      # Cloudflare WorkerçµŒç”±ã§Gemini APIå‘¼ã³å‡ºãE
    â””â”€â”€ fetchWithTimeout()                 # ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆä»˜ãfetch
        â”œâ”€â”€ fetch()
        â””â”€â”€ AbortController                # ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆåˆ¶å¾¡
```

### APIè¨­å®šç¢ºèªE

```
isConfigured()
â””â”€â”€ API_ENDPOINT.includes('example')      # ä»®ã‚¨ãƒ³ãƒ‰ãEã‚¤ãƒ³ãƒˆã‹ãƒã‚§ãƒE‚¯
```

---

## Face Detector

### å‘ãæ¤œåEãƒ¡ã‚¤ãƒ³å‡¦çE

```
detectVideoOrientation(video)         â†EContent Scriptã‹ã‚‰å‘¼ã³å‡ºãE
â”œâ”€â”€ createFaceDetector()              # FaceDetector APIã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæE
â”E  â””â”€â”€ new FaceDetector()
â”œâ”€â”€ detectByFaceAPI()                 # FaceDetector APIã§æ¤œåEEˆå„ªå…ˆï¼E
â”E  â”œâ”€â”€ detector.detect()
â”E  â”œâ”€â”€ analyzeFromLandmarks()        # ãƒ©ãƒ³ãƒ‰ãEãƒ¼ã‚¯ã‹ã‚‰å‘ãåˆE
â”E  â”E  â””â”€â”€ Math.atan2()              # ç›®â†’å£ãƒ™ã‚¯ãƒˆãƒ«ã®è§’åº¦è¨ˆç®E
â”E  â””â”€â”€ ãƒã‚¦ãƒ³ãƒE‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹åˆE    # ãƒ©ãƒ³ãƒ‰ãEãƒ¼ã‚¯ãŒãªãE ´åE
â””â”€â”€ detectByColorAnalysis()           # è‚Œè‰²åˆEEˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯EE
    â”œâ”€â”€ canvas.getContext('2d')
    â”œâ”€â”€ ctx.drawImage()               # å‹•ç”»ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’æç”»
    â”œâ”€â”€ ctx.getImageData()            # ãƒ”ã‚¯ã‚»ãƒ«ãƒEEã‚¿å–å¾E
    â”œâ”€â”€ isSkinColor()                 # åEƒ”ã‚¯ã‚»ãƒ«ã®è‚Œè‰²åˆ¤å®E
    â”E  â””â”€â”€ è‰²ç›¸ãƒ»å½©åº¦ãƒ»æ˜åº¦ãƒã‚§ãƒE‚¯
    â””â”€â”€ é ˜åŸŸæ¯”è¼E                      # ä¸Šä¸‹å·¦å³ã®è‚Œè‰²æ¯”ç‡æ¯”è¼E
```

### è‚Œè‰²åˆ¤å®E

```
isSkinColor(r, g, b)
â”œâ”€â”€ æ˜åº¦ãƒã‚§ãƒE‚¯ (60 < max < 250)
â”œâ”€â”€ å½©åº¦ãƒã‚§ãƒE‚¯ (diff > 15)
â”œâ”€â”€ RGBé–¢ä¿‚ãƒã‚§ãƒE‚¯ (R > G > B)
â””â”€â”€ è‰²ç›¸ãƒã‚§ãƒE‚¯ (0-50Â° ã¾ãŸãE 340-360Â°)
```

---

## Background Service Worker

### ãƒ¡ãƒE‚»ãƒ¼ã‚¸å‡¦çE

```
chrome.runtime.onMessage              â†Eãƒ¡ãƒE‚»ãƒ¼ã‚¸å—ä¿¡
â””â”€â”€ handleMessage(message)
    â”œâ”€â”€ [GET_SETTINGS]
    â”E  â””â”€â”€ handleGetSettings()
    â”E      â””â”€â”€ getSettings()         # settings-manager.js
    â”E
    â”œâ”€â”€ [UPDATE_SETTINGS]
    â”E  â””â”€â”€ handleUpdateSettings(payload)
    â”E      â””â”€â”€ updateSettings()      # settings-manager.js
    â”E          â””â”€â”€ getSettings()
    â”E
    â”œâ”€â”€ [GET_ROTATION]
    â”E  â””â”€â”€ handleGetRotation(payload)
    â”E      â””â”€â”€ getVideoRotation()    # settings-manager.js
    â”E
    â”œâ”€â”€ [SAVE_ROTATION]
    â”E  â””â”€â”€ handleSaveRotation(payload)
    â”E      â””â”€â”€ saveVideoRotation()   # settings-manager.js
    â”E
    â””â”€â”€ [CLEAR_ALL_ROTATIONS]
        â””â”€â”€ handleClearAllRotations()
            â””â”€â”€ clearAllVideoRotations()  # settings-manager.js
```

### ã‚¤ãƒ³ã‚¹ãƒˆãEãƒ«ã‚¤ãƒ™ãƒ³ãƒE

```
chrome.runtime.onInstalled            â†Eæ‹¡å¼µæ©ŸèEã‚¤ãƒ³ã‚¹ãƒˆãEãƒ«/æ›´æ–°æ™E
â””â”€â”€ (ãƒ­ã‚°å‡ºåŠ›ãEã¿)
```

---

## Popup

### ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒE

```
initialize()                          â†Epopup.htmlèª­ã¿è¾¼ã¿æ™‚ã«è‡ªå‹•å®Ÿè¡E
â”œâ”€â”€ chrome.tabs.query()               # ç¾åœ¨ã®ã‚¿ãƒ–ã‚’å–å¾E
â”œâ”€â”€ updateSiteInfo(url)               # ã‚µã‚¤ãƒˆæƒ…å ±ã‚’è¡¨ç¤º
â”E  â””â”€â”€ showUnsupportedMessage()      # æœªå¯¾å¿œã‚µã‚¤ãƒˆæ™‚
â”œâ”€â”€ loadSettings()                    # è¨­å®šã‚’èª­ã¿è¾¼ã¿
â”E  â”œâ”€â”€ chrome.runtime.sendMessage(GET_SETTINGS)
â”E  â”E  â””â”€â”€ â†EBackground â†EhandleGetSettings()
â”E  â””â”€â”€ updateHotkeyHint()            # ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒEƒˆè¡¨ç¤ºæ›´æ–°
â””â”€â”€ setupEventListeners()             # ã‚¤ãƒ™ãƒ³ãƒˆè¨­å®E
```

### å›è»¢ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒE‚¯å‡¦çE

```
rotationButton.click                  â†Eå›è»¢ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒE‚¯
â””â”€â”€ setRotation(rotation)
    â”œâ”€â”€ chrome.tabs.sendMessage(SET_ROTATION)
    â”E  â””â”€â”€ â†EContent Script
    â””â”€â”€ updateRotationUI()
```

### è¨­å®šãƒªãƒ³ã‚¯ã‚¯ãƒªãƒE‚¯å‡¦çE

```
openOptionsLink.click                 â†Eè¨­å®šãƒªãƒ³ã‚¯ã‚¯ãƒªãƒE‚¯
â””â”€â”€ chrome.runtime.openOptionsPage()
```

---

## Options

### ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒE

```
initialize()                          â†Eoptions.htmlèª­ã¿è¾¼ã¿æ™‚ã«è‡ªå‹•å®Ÿè¡E
â”œâ”€â”€ loadSettings()                    # è¨­å®šã‚’èª­ã¿è¾¼ã¿
â”E  â””â”€â”€ chrome.runtime.sendMessage(GET_SETTINGS)
â”E      â””â”€â”€ â†EBackground â†EhandleGetSettings()
â””â”€â”€ setupEventListeners()             # ã‚¤ãƒ™ãƒ³ãƒˆè¨­å®E
```

### è¨­å®šå¤‰æ›´å‡¦çE

```
buttonPositionSelect.change           â†Eãƒœã‚¿ãƒ³ä½ç½®å¤‰æ›´
â””â”€â”€ saveSettings({ buttonPosition })
    â”œâ”€â”€ chrome.runtime.sendMessage(UPDATE_SETTINGS)
    â”E  â””â”€â”€ â†EBackground â†EhandleUpdateSettings()
    â””â”€â”€ showSaveNotification()

hotkeyPresetSelect.change             â†Eãƒ›ãƒƒãƒˆã‚­ãƒ¼å¤‰æ›´
â””â”€â”€ saveSettings({ hotkeyPreset })

resetOnVideoChangeCheckbox.change     â†Eãƒªã‚»ãƒEƒˆè¨­å®šå¤‰æ›´
â””â”€â”€ saveSettings({ resetOnVideoChange })

rememberRotationCheckbox.change       â†Eè¨˜æEè¨­å®šå¤‰æ›´
â””â”€â”€ saveSettings({ rememberRotation })

defaultRotationSelect.change          â†EãƒEƒ•ã‚©ãƒ«ãƒˆå›è»¢å¤‰æ›´
â””â”€â”€ saveSettings({ defaultRotation })
```

### å›è»¢è¨­å®šã‚¯ãƒªã‚¢å‡¦çE

```
clearRotationsBtn.click               â†Eã‚¯ãƒªã‚¢ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒE‚¯
â””â”€â”€ clearAllRotations()
    â””â”€â”€ chrome.runtime.sendMessage(CLEAR_ALL_ROTATIONS)
        â””â”€â”€ â†EBackground â†EhandleClearAllRotations()
```

---

## Settings Manager

### é–¢æ•°å‘¼ã³å‡ºã—é–¢ä¿E

```
getSettings()
â””â”€â”€ chrome.storage.local.get()

updateSettings(updates)
â”œâ”€â”€ getSettings()                     # ç¾åœ¨ã®è¨­å®šã‚’å–å¾E
â””â”€â”€ chrome.storage.local.set()

getVideoRotation(videoId)
â””â”€â”€ chrome.storage.local.get()

saveVideoRotation(videoId, rotation)
â”œâ”€â”€ isValidRotation()                 # constants.js
â”œâ”€â”€ chrome.storage.local.get()
â””â”€â”€ chrome.storage.local.set()

deleteVideoRotation(videoId)
â”œâ”€â”€ chrome.storage.local.get()
â””â”€â”€ chrome.storage.local.set()

clearAllVideoRotations()
â”œâ”€â”€ chrome.storage.local.get()
â””â”€â”€ chrome.storage.local.set()

getAllStorage()
â””â”€â”€ chrome.storage.local.get(null)
```

---

## ã‚³ãƒ³ãƒãEãƒãƒ³ãƒˆé–“é€šä¿¡

### é€šä¿¡ãƒ•ãƒ­ãƒ¼å›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”E
â”E                             User Actions                                â”E
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”E
            â”E                    â”E                    â”E
            â–¼                     â–¼                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”E â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”E â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”E
â”E  Content Script  â”E â”E     Popup        â”E â”E    Options       â”E
â”E (content/index)  â”E â”E (popup/popup)    â”E â”E(options/options) â”E
â”E        â”E        â”E â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”E â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”E
â”E        â–¼         â”E           â”E                     â”E
â”E â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”E â”E           â”E                     â”E
â”E â”Eace Detectorâ”E â”E           â”E                     â”E
â”E â”Eface-       â”E â”E           â”E                     â”E
â”E â”Edetector.js)â”E â”E           â”E                     â”E
â”E â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”E â”E           â”E                     â”E
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”E           â”E                     â”E
          â”E                     â”E                     â”E
          â”EDirect Storage       â”Echrome.runtime      â”Echrome.runtime
          â”EAccess               â”E.sendMessage()      â”E.sendMessage()
          â”E                     â”E                    â”E
          â”E                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”E
          â”E                                â”E
          â”E                                â–¼
          â”E                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”E
          â”E                     â”EBackground Worker â”E
          â”E                     â”E(service-worker)  â”E
          â”E                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”E
          â”E                               â”E
          â”E                               â”Eimport
          â”E                               â–¼
          â”E                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”E
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”E Settings Manager â”E
                                 â”E(settings-manager)â”E
                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”E
                                           â”E
                                           â–¼
                                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”E
                                 â”E Chrome Storage   â”E
                                 â”E     (local)      â”E
                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”E
```

### ãƒ¡ãƒE‚»ãƒ¼ã‚¸ã‚¿ã‚¤ãƒ—ä¸€è¦§

| ãƒ¡ãƒE‚»ãƒ¼ã‚¸ | é€ä¿¡å…E| å—ä¿¡å…E| å‡¦çEEå®¹ |
|-----------|--------|--------|---------|
| `GET_SETTINGS` | Popup, Options | Background | è¨­å®šã‚’å–å¾E|
| `UPDATE_SETTINGS` | Options | Background | è¨­å®šã‚’æ›´æ–° |
| `GET_ROTATION` | - | Background | å‹•ç”»ã®å›è»¢è¨­å®šã‚’å–å¾E|
| `SAVE_ROTATION` | - | Background | å‹•ç”»ã®å›è»¢è¨­å®šã‚’ä¿å­E|
| `CLEAR_ALL_ROTATIONS` | Options | Background | ã™ã¹ã¦ã®å›è»¢è¨­å®šã‚’å‰Šé™¤ |
| `SET_ROTATION` | Popup | Content Script | æŒE®šè§’åº¦ã«å›è»¢ |

---

## é–¢æ•°ä¾å­˜ã‚°ãƒ©ãƒ•ï¼ˆç°¡ç•¥ç‰ˆï¼E

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”E
                    â”E  initialize()  â”E
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”E
                             â”E
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”E
         â”E                  â”E                  â”E
         â–¼                   â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”Eâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”Eâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”E
â”E loadSettings() â”Eâ”EwaitForPlayer() â”Eâ”‚observeVideo()   â”E
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”Eâ””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”Eâ””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”E
         â”E                  â”E                  â”E
         â”E                  â–¼                   â”E
         â”E         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”E         â”E
         â”E         â”EsetupRotation() â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”E
         â”E         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”E
         â”E                  â”E
         â”E    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”E
         â”E    â”E            â”E            â”E
         â”E    â–¼             â–¼             â–¼
         â”Eâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”Eâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”Eâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”E
         â”Eâ”‚injectUI â”Eâ”‚loadVideo  â”Eâ”E setRotation()  â”E
         â”Eâ”E  ()    â”Eâ”‚Rotation() â”Eâ””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”E
         â”Eâ””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”Eâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”E         â”E
         â”E     â”E                            â”E
         â”E     â–¼                             â–¼
         â”Eâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”E   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”E
         â”Eâ”‚createRotateButtonâ”E   â”‚updateButtonState()â”E
         â”Eâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”E   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”E
         â”E
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”E      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”E
â”EhandleKeyDown() â”‚â”€â”€â”€â”€â”€â”€â–¶â”E handleRotate() â”E
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”E      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”E
                                   â”E
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”E
                    â”E             â”E             â”E
                    â–¼              â–¼              â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”Eâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”Eâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”E
           â”‚rotateNext()â”Eâ”‚getCurrent   â”Eâ”‚saveVideo     â”E
           â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”Eâ”‚VideoId()    â”Eâ”‚Rotation()    â”E
                 â”E       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”Eâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”E
                 â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”E
         â”‚setRotation()â”E
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”E
```

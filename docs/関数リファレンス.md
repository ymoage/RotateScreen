# RotateScreen é–¢æ•°ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹

| é E›® | å€¤ |
|------|-----|
| ãƒãEã‚¸ãƒ§ãƒ³ | v1.3.1 |
| ãƒªãƒ“ã‚¸ãƒ§ãƒ³ | bff54a9 |
| æ›´æ–°æ—¥ | 2025-12-10 |

åEƒ•ã‚¡ã‚¤ãƒ«ã«å®šç¾©ã•ã‚Œã¦ãE‚‹é–¢æ•°ã®è©³ç´°ãªãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ã§ã™ã€E

---

## ç›®æ¬¡

1. [content/index.js](#contentindexjs)
2. [content/ai-detector.js](#contentai-detectorjs)
3. [content/face-detector.js](#contentface-detectorjs)
4. [content/player-detector.js](#contentplayer-detectorjs)
5. [content/rotation-control.js](#contentrotation-controljs)
6. [content/overlay-ui.js](#contentoverlay-uijs)
7. [background/service-worker.js](#backgroundservice-workerjs)
8. [storage/settings-manager.js](#storagesettings-managerjs)
9. [utils/constants.js](#utilsconstantsjs)
10. [utils/youtube-selectors.js](#utilsyoutube-selectorsjs)
11. [popup/popup.js](#popuppopupjs)
12. [options/options.js](#optionsoptionsjs)

---

## content/index.js

ãƒ¡ã‚¤ãƒ³ã®ã‚³ãƒ³ãƒEƒ³ãƒE‚¹ã‚¯ãƒªãƒ—ãƒˆã€EouTubeãƒšãEã‚¸ã«å›è»¢æ©ŸèEã‚’æ³¨å…¥ã™ã‚‹å˜ä¸€ãƒ•ã‚¡ã‚¤ãƒ«ç‰ˆã€E

### ãƒ¦ãƒ¼ãƒE‚£ãƒªãƒE‚£é–¢æ•°

#### `isValidRotation(rotation)`
å›è»¢è§’åº¦ãŒæœ‰åŠ¹ã‹ãƒã‚§ãƒE‚¯ã™ã‚‹ã€E

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | åE| èª¬æ˜E|
|-----------|-----|------|
| `rotation` | `number` | ãƒã‚§ãƒE‚¯ã™ã‚‹è§’åº¦ |

| æˆ»ã‚Šå€¤ | åE| èª¬æ˜E|
|--------|-----|------|
| - | `boolean` | æœ‰åŠ¹ãªè§’åº¦EE, 90, 180, 270E‰ãªã‚E`true` |

---

#### `getNextRotation(current)`
æ¬¡ã®å›è»¢è§’åº¦ã‚’è¨ˆç®—ã™ã‚‹ã€E

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | åE| èª¬æ˜E|
|-----------|-----|------|
| `current` | `number` | ç¾åœ¨ã®å›è»¢è§’åº¦ |

| æˆ»ã‚Šå€¤ | åE| èª¬æ˜E|
|--------|-----|------|
| - | `number` | æ¬¡ã®å›è»¢è§’åº¦EE0åº¦åŠ ç®—ã€E60ã§å¾ªç’°EE|

---

#### `extractVideoId(url)`
URLã‹ã‚‰YouTubeå‹•ç”»IDã‚’æŠ½å‡ºã™ã‚‹ã€E

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | åE| èª¬æ˜E|
|-----------|-----|------|
| `url` | `string` | YouTubeã®URL |

| æˆ»ã‚Šå€¤ | åE| èª¬æ˜E|
|--------|-----|------|
| - | `string\|null` | å‹•ç”»IDã€æŠ½å‡ºã§ããªãE ´åˆãE `null` |

å¯¾å¿œå½¢å¼E
- æ¨™æºE `youtube.com/watch?v=xxxxx`
- çŸ­ç¸®: `youtu.be/xxxxx`
- åŸ‹ã‚è¾¼ã¿: `youtube.com/embed/xxxxx`

---

#### `isYouTube()`
ç¾åœ¨ã®ãƒšãEã‚¸ãŒYouTubeã‹ãƒã‚§ãƒE‚¯ã™ã‚‹ã€E

| æˆ»ã‚Šå€¤ | åE| èª¬æ˜E|
|--------|-----|------|
| - | `boolean` | YouTubeãªã‚E`true` |

---

#### `isLiveStream()`
ç¾åœ¨ã®å‹•ç”»ãŒãƒ©ã‚¤ãƒ–éEä¿¡ã‹ãƒã‚§ãƒE‚¯ã™ã‚‹ã€E

| æˆ»ã‚Šå€¤ | åE| èª¬æ˜E|
|--------|-----|------|
| - | `boolean` | ãƒ©ã‚¤ãƒ–éEä¿¡ãªã‚E`true` |

æ¤œåEæ–¹æ³E
- URLã« `/live/` ãŒå«ã¾ã‚Œã‚‹
- `.ytp-live-badge` è¦ç´ ãŒè¡¨ç¤ºã•ã‚Œã¦ãE‚‹
- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã« `ytp-live` ã‚¯ãƒ©ã‚¹ãŒã‚ã‚E
- ãƒ©ã‚¤ãƒ–ãƒãƒ£ãƒEƒˆè¦ç´ ãŒå­˜åœ¨ã™ã‚‹

---

### ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æ¤œåEé–¢æ•°

#### `detectPlayer()`
YouTubeã®å‹•ç”»ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼è¦ç´ ã‚’å–å¾—ã™ã‚‹ã€E

| æˆ»ã‚Šå€¤ | åE| èª¬æ˜E|
|--------|-----|------|
| - | `HTMLElement\|null` | `#movie_player` è¦ç´  |

---

#### `detectVideoContainer()`
å‹•ç”»ã‚³ãƒ³ãƒEƒŠè¦ç´ ã‚’å–å¾—ã™ã‚‹ã€E

| æˆ»ã‚Šå€¤ | åE| èª¬æ˜E|
|--------|-----|------|
| - | `HTMLElement\|null` | `.html5-video-container` è¦ç´  |

---

#### `detectVideo()`
videoè¦ç´ ã‚’å–å¾—ã™ã‚‹ã€E

| æˆ»ã‚Šå€¤ | åE| èª¬æ˜E|
|--------|-----|------|
| - | `HTMLVideoElement\|null` | `video.html5-main-video` è¦ç´  |

---

#### `getCurrentVideoId()`
ç¾åœ¨ã®ãƒšãEã‚¸ã®å‹•ç”»IDã‚’å–å¾—ã™ã‚‹ã€E

| æˆ»ã‚Šå€¤ | åE| èª¬æ˜E|
|--------|-----|------|
| - | `string\|null` | å‹•ç”»ID |

---

#### `isPlayerReady()`
ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒæº–å‚™å®ŒäºE‹ãƒã‚§ãƒE‚¯ã™ã‚‹ã€E

| æˆ»ã‚Šå€¤ | åE| èª¬æ˜E|
|--------|-----|------|
| - | `boolean` | ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ãƒ“ãƒ‡ã‚ªè¦ç´ ãŒå­˜åœ¨ã™ã‚Œã° `true` |

---

#### `waitForPlayer(timeout, interval)`
ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®æº–å‚™ã‚’å¾E¤ã€E

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | åE| ãƒEƒ•ã‚©ãƒ«ãƒE| èª¬æ˜E|
|-----------|-----|-----------|------|
| `timeout` | `number` | `10000` | ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼ˆãƒŸãƒªç§’ï¼E|
| `interval` | `number` | `500` | ãƒã‚§ãƒE‚¯é–“éš”EˆãƒŸãƒªç§’ï¼E|

| æˆ»ã‚Šå€¤ | åE| èª¬æ˜E|
|--------|-----|------|
| - | `Promise<boolean>` | ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒè¦‹ã¤ã‹ã£ãŸã‚‰ `true` |

---

### å›è»¢åˆ¶å¾¡é–¢æ•°

#### `removeRotationClasses(video)`
å‹•ç”»è¦ç´ ã‹ã‚‰å›è»¢é–¢é€£ã®CSSã‚¯ãƒ©ã‚¹ã‚’å‰Šé™¤ã™ã‚‹ã€E

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | åE| èª¬æ˜E|
|-----------|-----|------|
| `video` | `HTMLVideoElement` | å‹•ç”»è¦ç´  |

---

#### `setRotation(rotation)`
å‹•ç”»ã®å›è»¢è§’åº¦ã‚’è¨­å®šã™ã‚‹ã€E

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | åE| èª¬æ˜E|
|-----------|-----|------|
| `rotation` | `number` | å›è»¢è§’åº¦EE, 90, 180, 270EE|

| æˆ»ã‚Šå€¤ | åE| èª¬æ˜E|
|--------|-----|------|
| - | `boolean` | æˆåŠŸãªã‚E`true` |

å‡¦çEEå®¹:
1. æ—¢å­˜ãEå›è»¢ã‚¯ãƒ©ã‚¹ã‚’å‰Šé™¤
2. æ–°ã—ã„å›è»¢ã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ 
3. 90åº¦/270åº¦ã®å ´åˆãEã‚¹ã‚±ãƒ¼ãƒ«è¨ˆç®E
4. ãƒœã‚¿ãƒ³çŠ¶æ…‹ã‚’æ›´æ–°

---

#### `rotateNext()`
æ¬¡ã®è§’åº¦ã«å›è»¢ã™ã‚‹ã€E

| æˆ»ã‚Šå€¤ | åE| èª¬æ˜E|
|--------|-----|------|
| - | `number` | æ–°ã—ã„å›è»¢è§’åº¦ |

---

#### `resetRotation()`
å›è»¢ã‚Eåº¦ã«ãƒªã‚»ãƒEƒˆã™ã‚‹ã€E

---

### UIé–¢æ•°

#### `createRotateButton(isControlbar)`
å›è»¢ãƒœã‚¿ãƒ³ã‚’ä½œæEã™ã‚‹ã€E

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | åE| èª¬æ˜E|
|-----------|-----|------|
| `isControlbar` | `boolean` | ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒãEç”¨ãƒœã‚¿ãƒ³ãªã‚E`true` |

| æˆ»ã‚Šå€¤ | åE| èª¬æ˜E|
|--------|-----|------|
| - | `HTMLButtonElement` | ãƒœã‚¿ãƒ³è¦ç´  |

---

#### `updateButtonState(rotation)`
ãƒœã‚¿ãƒ³ã®è¡¨ç¤ºçŠ¶æ…‹ã‚’æ›´æ–°ã™ã‚‹ã€E

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | åE| èª¬æ˜E|
|-----------|-----|------|
| `rotation` | `number` | ç¾åœ¨ã®å›è»¢è§’åº¦ |

---

#### `removeExistingButton()`
æ—¢å­˜ãEå›è»¢ãƒœã‚¿ãƒ³ã‚’å‰Šé™¤ã™ã‚‹ã€E

---

#### `injectOverlayUI()`
ã‚ªãƒ¼ãƒãEãƒ¬ã‚¤ä½ç½®ã«ãƒœã‚¿ãƒ³ã‚’æŒ¿å…¥ã™ã‚‹ã€E

| æˆ»ã‚Šå€¤ | åE| èª¬æ˜E|
|--------|-----|------|
| - | `boolean` | æˆåŠŸãªã‚E`true` |

---

#### `injectControlbarUI()`
ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒãEã«ãƒœã‚¿ãƒ³ã‚’æŒ¿å…¥ã™ã‚‹ã€E

| æˆ»ã‚Šå€¤ | åE| èª¬æ˜E|
|--------|-----|------|
| - | `boolean` | æˆåŠŸãªã‚E`true`Eˆå¤±æ•—æ™‚ã¯ã‚ªãƒ¼ãƒãEãƒ¬ã‚¤ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯EE|

---

#### `injectUI()`
è¨­å®šã«å¿œã˜ãŸä½ç½®ã«ãƒœã‚¿ãƒ³ã‚’æŒ¿å…¥ã™ã‚‹ã€E

| æˆ»ã‚Šå€¤ | åE| èª¬æ˜E|
|--------|-----|------|
| - | `boolean` | æˆåŠŸãªã‚E`true` |

---

### ã‚­ãƒ¼ãƒœãEãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒEƒˆé–¢æ•°

#### `isInputFocused(target)`
å…¥åŠ›è¦ç´ ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ãŒã‚ã‚‹ã‹ãƒã‚§ãƒE‚¯ã™ã‚‹ã€E

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | åE| èª¬æ˜E|
|-----------|-----|------|
| `target` | `HTMLElement` | ã‚¤ãƒ™ãƒ³ãƒˆã‚¿ãƒ¼ã‚²ãƒEƒˆ |

| æˆ»ã‚Šå€¤ | åE| èª¬æ˜E|
|--------|-----|------|
| - | `boolean` | input/textarea/contentEditableãªã‚E`true` |

---

#### `matchesHotkey(event, preset)`
ã‚­ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆãŒãƒ›ãƒƒãƒˆã‚­ãƒ¼ãƒ—ãƒªã‚»ãƒEƒˆã¨ä¸€è‡´ã™ã‚‹ã‹ãƒã‚§ãƒE‚¯ã™ã‚‹ã€E

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | åE| èª¬æ˜E|
|-----------|-----|------|
| `event` | `KeyboardEvent` | ã‚­ãƒ¼ãƒœãEãƒ‰ã‚¤ãƒ™ãƒ³ãƒE|
| `preset` | `object` | ãƒ›ãƒƒãƒˆã‚­ãƒ¼ãƒ—ãƒªã‚»ãƒEƒˆè¨­å®E|

| æˆ»ã‚Šå€¤ | åE| èª¬æ˜E|
|--------|-----|------|
| - | `boolean` | ä¸€è‡´ã™ã‚Œã° `true` |

---

#### `handleKeyDown(event)`
keydownã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ã€E

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | åE| èª¬æ˜E|
|-----------|-----|------|
| `event` | `KeyboardEvent` | ã‚­ãƒ¼ãƒœãEãƒ‰ã‚¤ãƒ™ãƒ³ãƒE|

---

### ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸é–¢æ•°

#### `loadSettings()`
Chrome Storageã‹ã‚‰è¨­å®šã‚’èª­ã¿è¾¼ã‚€ã€E

| æˆ»ã‚Šå€¤ | åE| èª¬æ˜E|
|--------|-----|------|
| - | `Promise<void>` | - |

èª­ã¿è¾¼ã‚€è¨­å®E
- `hotkeyPreset`: ã‚­ãƒ¼ãƒœãEãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒEƒˆ
- `rememberRotation`: å›è»¢è¨˜æEã®æœ‰ç„¡
- `resetOnVideoChange`: å‹•ç”»åˆE‚Šæ›¿ãˆæ™‚ãƒªã‚»ãƒEƒˆ
- `buttonPosition`: ãƒœã‚¿ãƒ³è¡¨ç¤ºä½ç½®

---

#### `loadVideoRotation(videoId)`
å‹•ç”»ã®ä¿å­˜æ¸ˆã¿å›è»¢è§’åº¦ã‚’èª­ã¿è¾¼ã‚€ã€E

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | åE| èª¬æ˜E|
|-----------|-----|------|
| `videoId` | `string` | YouTubeå‹•ç”»ID |

| æˆ»ã‚Šå€¤ | åE| èª¬æ˜E|
|--------|-----|------|
| - | `Promise<number\|null>` | ä¿å­˜æ¸ˆã¿å›è»¢è§’åº¦ã€ãªã‘ã‚Œã° `null` |

---

#### `saveVideoRotation(videoId, rotation)`
å‹•ç”»ã®å›è»¢è§’åº¦ã‚’ä¿å­˜ã™ã‚‹ã€E

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | åE| èª¬æ˜E|
|-----------|-----|------|
| `videoId` | `string` | YouTubeå‹•ç”»ID |
| `rotation` | `number` | å›è»¢è§’åº¦ |

| æˆ»ã‚Šå€¤ | åE| èª¬æ˜E|
|--------|-----|------|
| - | `Promise<void>` | - |

---

### è‡ªå‹•å›è»¢é–¢æ•°

#### `tryAutoRotation(video)`
é¡”æ¤œåEã«ã‚ˆã‚‹è‡ªå‹•å›è»¢ã‚’è©¦è¡Œã™ã‚‹ã€E

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | åE| èª¬æ˜E|
|-----------|-----|------|
| `video` | `HTMLVideoElement` | å‹•ç”»è¦ç´  |

| æˆ»ã‚Šå€¤ | åE| èª¬æ˜E|
|--------|-----|------|
| - | `Promise<boolean>` | è‡ªå‹•å›è»¢ãŒé©ç”¨ã•ã‚ŒãŸå ´åE`true` |

å‡¦çEEå®¹:
1. è‡ªå‹•å›è»¢ãŒæœ‰åŠ¹ã‹ãƒã‚§ãƒE‚¯
2. ãƒ©ã‚¤ãƒ–éEä¿¡ãªã‚‰ã‚¹ã‚­ãƒEE
3. FaceDetectorãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§æ¤œåE
4. æ¤œåEæˆåŠŸãªã‚‰å›è»¢ã‚’é©ç”¨
5. é€šçŸ¥ã‚’è¡¨ç¤º

---

#### `showAutoRotationNotification(rotation, method)`
è‡ªå‹•å›è»¢é€šçŸ¥ã‚’è¡¨ç¤ºã™ã‚‹ã€E

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | åE| èª¬æ˜E|
|-----------|-----|------|
| `rotation` | `number` | é©ç”¨ã•ã‚ŒãŸå›è»¢è§’åº¦ |
| `method` | `string` | æ¤œåEæ–¹æ³•ï¼E'faceapi'` or `'color'`EE|

3ç§’å¾Œã«è‡ªå‹•çš„ã«ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆã™ã‚‹ã€E

---

### ãƒ¡ã‚¤ãƒ³ãƒ­ã‚¸ãƒE‚¯é–¢æ•°

#### `handleRotate()`
å›è»¢æ“ä½œã‚’å®Ÿè¡Œã™ã‚‹ã€E

å‡¦çEEå®¹:
1. æ¬¡ã®è§’åº¦ã«å›è»¢
2. å‹•ç”»IDãŒã‚ã‚ŒãEå›è»¢çŠ¶æ…‹ã‚’ä¿å­E

---

#### `setupRotation()`
å›è»¢æ©ŸèEã‚’ã‚»ãƒEƒˆã‚¢ãƒEEã™ã‚‹ã€E

| æˆ»ã‚Šå€¤ | åE| èª¬æ˜E|
|--------|-----|------|
| - | `Promise<void>` | - |

å‡¦çEEå®¹:
1. UIã‚’æŒ¿å…¥
2. ä¿å­˜æ¸ˆã¿å›è»¢ãŒã‚ã‚ŒãEå¾©å…E

---

#### `observeVideoChange()`
å‹•ç”»åˆE‚Šæ›¿ãˆã‚’ç›£è¦–ã™ã‚‹ã€E

MutationObserverã‚’ä½¿ç”¨ã—ã¦ã‚¿ã‚¤ãƒˆãƒ«å¤‰æ›´ã¨DOMå¤‰æ›´ã‚’ç›£è¦–ã—ã€å‹•ç”»åˆE‚Šæ›¿ãˆæ™‚ã«å›è»¢ã‚’ãƒªã‚»ãƒEƒˆ/å¾©å…E™ã‚‹ã€E

---

#### `handleFullscreenChange()`
ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³åˆE‚Šæ›¿ãˆæ™‚ã®ãƒãƒ³ãƒ‰ãƒ©ã€E

100mséE»¶å¾Œã«ç¾åœ¨ã®å›è»¢ã‚’åEé©ç”¨ã™ã‚‹ã€E

---

#### `initialize()`
æ‹¡å¼µæ©ŸèEã‚’åEæœŸåŒ–ã™ã‚‹ã€E

| æˆ»ã‚Šå€¤ | åE| èª¬æ˜E|
|--------|-----|------|
| - | `Promise<void>` | - |

å‡¦çEEå®¹:
1. YouTubeãƒšãEã‚¸ã‹ãƒã‚§ãƒE‚¯
2. è¨­å®šã‚’èª­ã¿è¾¼ã¿
3. ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æº–å‚™ã‚’å¾E©E
4. å›è»¢æ©ŸèEã‚’ã‚»ãƒEƒˆã‚¢ãƒEE
5. ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãEã‚’ç™»éŒ²
6. å‹•ç”»åˆE‚Šæ›¿ãˆç›£è¦–ã‚’é–‹å§E

---

## content/ai-detector.js

Gemini APIçµŒç”±ã®AIåˆ¤å®šã«ã‚ˆã‚‹å‹•ç”»ã®å‘ãåˆ¤å®šãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«Eˆå®Ÿé¨“æ©ŸèEE‰ã€E

### å®šæ•°

| å®šæ•°åE| åE| å€¤ | èª¬æ˜E|
|--------|-----|-----|------|
| `API_ENDPOINT` | `string` | `'https://...'` | Cloudflare Worker APIã‚¨ãƒ³ãƒ‰ãEã‚¤ãƒ³ãƒˆï¼ˆä»®EE|
| `DEFAULT_TIMEOUT` | `number` | `10000` | ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼ˆãƒŸãƒªç§’ï¼E|

---

### é–¢æ•°

#### `captureFrame(video, maxSize)`
å‹•ç”»ã‹ã‚‰ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’ã‚­ãƒ£ãƒ—ãƒãƒ£ã—ã¦Base64ç”»åƒã‚’ç”ŸæEã€E

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | åE| ãƒEƒ•ã‚©ãƒ«ãƒE| èª¬æ˜E|
|-----------|-----|-----------|------|
| `video` | `HTMLVideoElement` | - | å‹•ç”»è¦ç´  |
| `maxSize` | `number` | `512` | æœ€å¤§ã‚µã‚¤ã‚ºEˆãƒ”ã‚¯ã‚»ãƒ«EE|

| æˆ»ã‚Šå€¤ | åE| èª¬æ˜E|
|--------|-----|------|
| - | `string\|null` | Base64ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸç”»åƒãƒ‡ãƒ¼ã‚¿ |

---

#### `fetchWithTimeout(url, options, timeout)`
ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆä»˜ãã®fetchã€E

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | åE| èª¬æ˜E|
|-----------|-----|------|
| `url` | `string` | URL |
| `options` | `object` | fetchã‚ªãƒ—ã‚·ãƒ§ãƒ³ |
| `timeout` | `number` | ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼ˆãƒŸãƒªç§’ï¼E|

| æˆ»ã‚Šå€¤ | åE| èª¬æ˜E|
|--------|-----|------|
| - | `Promise<Response>` | fetchã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ |

| ä¾‹å¤E| èª¬æ˜E|
|------|------|
| `Error('Request timeout')` | ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆæ™‚ |

---

#### `detectOrientationByAI(imageData, timeout)`
Cloudflare WorkerçµŒç”±ã§Gemini APIã«ç”»åƒã‚’é€ä¿¡ã—ã¦å‘ãã‚’åˆ¤å®šã€E

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | åE| ãƒEƒ•ã‚©ãƒ«ãƒE| èª¬æ˜E|
|-----------|-----|-----------|------|
| `imageData` | `string` | - | Base64ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸç”»åƒãƒ‡ãƒ¼ã‚¿ |
| `timeout` | `number` | `10000` | ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼ˆãƒŸãƒªç§’ï¼E|

| æˆ»ã‚Šå€¤ | åE| èª¬æ˜E|
|--------|-----|------|
| - | `Promise<object>` | `{ detected, rotation, confidence, reason, method }` |

---

#### `detectVideoOrientation(video, options)`
å‹•ç”»ã®å‘ãã‚’AIåˆ¤å®šã™ã‚‹ãƒ¡ã‚¤ãƒ³é–¢æ•°ã€E

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | åE| èª¬æ˜E|
|-----------|-----|------|
| `video` | `HTMLVideoElement` | å‹•ç”»è¦ç´  |
| `options.timeout` | `number` | ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼ˆãƒŸãƒªç§’ï¼E|
| `options.maxSize` | `number` | ç”»åƒãEæœ€å¤§ã‚µã‚¤ã‚º |

| æˆ»ã‚Šå€¤ | åE| èª¬æ˜E|
|--------|-----|------|
| - | `Promise<object>` | `{ detected, rotation, confidence, error?, method }` |

---

#### `isConfigured()`
APIã‚¨ãƒ³ãƒ‰ãEã‚¤ãƒ³ãƒˆãŒè¨­å®šã•ã‚Œã¦ãE‚‹ã‹ãƒã‚§ãƒE‚¯ã€E

| æˆ»ã‚Šå€¤ | åE| èª¬æ˜E|
|--------|-----|------|
| - | `boolean` | è¨­å®šæ¸ˆã¿ãªã‚E`true`Eˆç¾åœ¨ã¯ä»®å®Ÿè£EEãŸã‚å¸¸ã« `false`EE|

---

#### `setApiEndpoint(endpoint)`
APIã‚¨ãƒ³ãƒ‰ãEã‚¤ãƒ³ãƒˆã‚’æ›´æ–°Eˆå°E¥ã®æ‹¡å¼µç”¨E‰ã€E

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | åE| èª¬æ˜E|
|-----------|-----|------|
| `endpoint` | `string` | æ–°ã—ã„ã‚¨ãƒ³ãƒ‰ãEã‚¤ãƒ³ãƒE|

---

### ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒE

`window.RotateScreenAIDetector` ã¨ã—ã¦ã‚¨ã‚¯ã‚¹ãƒãEãƒE

| ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ | åE| èª¬æ˜E|
|-----------|-----|------|
| `detectVideoOrientation` | `function` | å‘ãæ¤œåEãƒ¡ã‚¤ãƒ³é–¢æ•° |
| `captureFrame` | `function` | ãƒ•ãƒ¬ãƒ¼ãƒ ã‚­ãƒ£ãƒ—ãƒãƒ£é–¢æ•° |
| `isConfigured` | `function` | APIè¨­å®šç¢ºèªé–¢æ•° |
| `setApiEndpoint` | `function` | ã‚¨ãƒ³ãƒ‰ãEã‚¤ãƒ³ãƒˆè¨­å®šé–¢æ•° |
| `DEFAULT_TIMEOUT` | `number` | ãƒEƒ•ã‚©ãƒ«ãƒˆã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒE|

---

## content/face-detector.js

é¡”æ¤œåEã«ã‚ˆã‚‹å‹•ç”»ã®å‘ãåˆ¤å®šãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«Eˆå®Ÿé¨“æ©ŸèEE‰ã€E

### ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°

| å¤‰æ•°åE| åE| èª¬æ˜E|
|--------|-----|------|
| `isFaceDetectionSupported` | `boolean` | FaceDetector APIãŒåˆ©ç”¨å¯èƒ½ãE|

---

### é–¢æ•°

#### `createFaceDetector()`
FaceDetector APIã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæEã™ã‚‹ã€E

| æˆ»ã‚Šå€¤ | åE| èª¬æ˜E|
|--------|-----|------|
| - | `FaceDetector\|null` | æ¤œåEå™¨ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã€ã‚µãƒãEãƒˆã•ã‚Œã¦ãEªãE ´åˆãE `null` |

---

#### `isSkinColor(r, g, b)`
ãƒ”ã‚¯ã‚»ãƒ«ãŒè‚Œè‰²ã‹ã©ãE‹ã‚’åˆ¤å®šã™ã‚‹ã€E

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | åE| èª¬æ˜E|
|-----------|-----|------|
| `r` | `number` | èµ¤æˆåEEE-255EE|
| `g` | `number` | ç·‘æEåˆE¼E-255EE|
| `b` | `number` | é’æEåˆE¼E-255EE|

| æˆ»ã‚Šå€¤ | åE| èª¬æ˜E|
|--------|-----|------|
| - | `boolean` | è‚Œè‰²ã¨åˆ¤å®šã•ã‚Œã‚Œã° `true` |

åˆ¤å®šåŸºæºE
- R > G > B ã®é–¢ä¿E
- è‰²ç›¸ãE-50åº¦ã¾ãŸãE340-360åº¦Eˆèµ¤ã€œã‚ªãƒ¬ãƒ³ã‚¸ã€œé»E‰²EE
- é©åˆEªæ˜åº¦ã¨å½©åº¦

---

#### `detectByColorAnalysis(video)`
è‚Œè‰²åˆEã«ã‚ˆã‚‹å‘ãæ¤œåEEˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯E‰ã€E

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | åE| èª¬æ˜E|
|-----------|-----|------|
| `video` | `HTMLVideoElement` | å‹•ç”»è¦ç´  |

| æˆ»ã‚Šå€¤ | åE| èª¬æ˜E|
|--------|-----|------|
| - | `Promise<object>` | `{ detected: boolean, rotation: number\|null, confidence: number }` |

å‡¦çEEå®¹:
1. å‹•ç”»ã‚E00x100ã®ã‚­ãƒ£ãƒ³ãƒã‚¹ã«æç”»
2. 4é ˜åŸŸEˆä¸Šä¸‹å·¦å³E‰ãEè‚Œè‰²æ¯”ç‡ã‚’è¨ˆç®E
3. è‚Œè‰²ãŒå¤šã„é ˜åŸŸã‚’é ­éƒ¨ã¨æ¨å®E
4. æ¨å®šã•ã‚ŒãŸå‘ãã‹ã‚‰å›è»¢è§’åº¦ã‚’æ±ºå®E

---

#### `detectByFaceAPI(detector, video)`
FaceDetector APIã‚’ä½¿ã£ãŸé¡”æ¤œåEã€E

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | åE| èª¬æ˜E|
|-----------|-----|------|
| `detector` | `FaceDetector` | æ¤œåEå™¨ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ |
| `video` | `HTMLVideoElement` | å‹•ç”»è¦ç´  |

| æˆ»ã‚Šå€¤ | åE| èª¬æ˜E|
|--------|-----|------|
| - | `Promise<object>` | `{ detected: boolean, rotation: number\|null, confidence: number }` |

---

#### `analyzeFromLandmarks(landmarks)`
é¡”ãEãƒ©ãƒ³ãƒ‰ãEãƒ¼ã‚¯ã‹ã‚‰å‘ãã‚’åEæã™ã‚‹ã€E

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | åE| èª¬æ˜E|
|-----------|-----|------|
| `landmarks` | `Array` | é¡”ãEãƒ©ãƒ³ãƒ‰ãEãƒ¼ã‚¯é…åE |

| æˆ»ã‚Šå€¤ | åE| èª¬æ˜E|
|--------|-----|------|
| - | `object` | `{ detected: boolean, rotation: number\|null, confidence: number }` |

ç›®ã¨å£ã®ä½ç½®é–¢ä¿‚ã‹ã‚‰è§’åº¦ã‚’è¨ˆç®—ã—ã€å›è»¢ã‚’åˆ¤å®šã™ã‚‹ã€E

---

#### `detectVideoOrientation(video)`
å‹•ç”»ã®å‘ãã‚’æ¤œåEã™ã‚‹ãƒ¡ã‚¤ãƒ³é–¢æ•°ã€E

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | åE| èª¬æ˜E|
|-----------|-----|------|
| `video` | `HTMLVideoElement` | å‹•ç”»è¦ç´  |

| æˆ»ã‚Šå€¤ | åE| èª¬æ˜E|
|--------|-----|------|
| - | `Promise<object>` | `{ detected: boolean, rotation: number\|null, method: string, confidence: number }` |

å‡¦çE EºE
1. FaceDetector APIã‚’è©¦è¡E
2. å¤±æ•—ã—ãŸå ´åˆãEè‚Œè‰²åˆEã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯

---

#### `isPortraitVideo(video)`
ç¸¦å‹•ç”»ã‹ã©ãE‹ã‚’åˆ¤å®šã™ã‚‹ã€E

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | åE| èª¬æ˜E|
|-----------|-----|------|
| `video` | `HTMLVideoElement` | å‹•ç”»è¦ç´  |

| æˆ»ã‚Šå€¤ | åE| èª¬æ˜E|
|--------|-----|------|
| - | `boolean` | ç¸¦å‹•ç”»ãªã‚E`true` |

---

### ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒE

`window.RotateScreenFaceDetector` ã¨ã—ã¦ã‚¨ã‚¯ã‚¹ãƒãEãƒE

| ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ | åE| èª¬æ˜E|
|-----------|-----|------|
| `detectVideoOrientation` | `function` | å‘ãæ¤œåEãƒ¡ã‚¤ãƒ³é–¢æ•° |
| `isPortraitVideo` | `function` | ç¸¦å‹•ç”»åˆ¤å®šé–¢æ•° |
| `isSupported` | `boolean` | FaceDetector APIã‚µãƒãEãƒˆçŠ¶æ³E|

---

## content/player-detector.js

YouTubeã®å‹•ç”»ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’æ¤œåEã™ã‚‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã€E

#### `detectPlayer()`
å‹•ç”»ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’æ¤œåEã™ã‚‹ã€E

| æˆ»ã‚Šå€¤ | åE| èª¬æ˜E|
|--------|-----|------|
| - | `HTMLElement\|null` | ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼è¦ç´  |

---

#### `detectVideoContainer()`
å‹•ç”»ã‚³ãƒ³ãƒEƒŠã‚’æ¤œåEã™ã‚‹ã€E

| æˆ»ã‚Šå€¤ | åE| èª¬æ˜E|
|--------|-----|------|
| - | `HTMLElement\|null` | å‹•ç”»ã‚³ãƒ³ãƒEƒŠè¦ç´  |

---

#### `detectVideo()`
å‹•ç”»è¦ç´ ã‚’æ¤œåEã™ã‚‹ã€E

| æˆ»ã‚Šå€¤ | åE| èª¬æ˜E|
|--------|-----|------|
| - | `HTMLVideoElement\|null` | å‹•ç”»è¦ç´  |

---

#### `getCurrentVideoId()`
ç¾åœ¨ã®å‹•ç”»IDã‚’å–å¾—ã™ã‚‹ã€E

| æˆ»ã‚Šå€¤ | åE| èª¬æ˜E|
|--------|-----|------|
| - | `string\|null` | å‹•ç”»ID |

---

#### `isPlayerReady()`
ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒå­˜åœ¨ã™ã‚‹ã‹ãƒã‚§ãƒE‚¯ã™ã‚‹ã€E

| æˆ»ã‚Šå€¤ | åE| èª¬æ˜E|
|--------|-----|------|
| - | `boolean` | æº–å‚™å®ŒäºEªã‚E`true` |

---

#### `waitForPlayer(timeout, interval)`
ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®æº–å‚™ã‚’å¾E¤ã€E

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | åE| ãƒEƒ•ã‚©ãƒ«ãƒE| èª¬æ˜E|
|-----------|-----|-----------|------|
| `timeout` | `number` | `10000` | ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼EsEE|
| `interval` | `number` | `500` | ãƒã‚§ãƒE‚¯é–“éš”EEsEE|

| æˆ»ã‚Šå€¤ | åE| èª¬æ˜E|
|--------|-----|------|
| - | `Promise<boolean>` | è¦‹ã¤ã‹ã£ãŸã‚‰ `true` |

---

#### `observeVideoChange(callback)`
URLå¤‰æ›´ã‚’ç›£è¦–ã—ã¦å‹•ç”»IDå¤‰æ›´ã‚’æ¤œåEã™ã‚‹ã€E

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | åE| èª¬æ˜E|
|-----------|-----|------|
| `callback` | `function` | å‹•ç”»IDå¤‰æ›´æ™‚ã«å‘¼ã°ã‚Œã‚‹ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ |

| æˆ»ã‚Šå€¤ | åE| èª¬æ˜E|
|--------|-----|------|
| - | `function` | ç›£è¦–è§£é™¤é–¢æ•° |

---

## content/rotation-control.js

CSS transformã‚’ä½¿ç”¨ã—ãŸå‹•ç”»å›è»¢ãƒ­ã‚¸ãƒE‚¯ã€E

#### `getCurrentRotation()`
ç¾åœ¨ã®å›è»¢è§’åº¦ã‚’å–å¾—ã™ã‚‹ã€E

| æˆ»ã‚Šå€¤ | åE| èª¬æ˜E|
|--------|-----|------|
| - | `number` | ç¾åœ¨ã®å›è»¢è§’åº¦ |

---

#### `setRotation(rotation)`
å›è»¢è§’åº¦ã‚’è¨­å®šã™ã‚‹ã€E

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | åE| èª¬æ˜E|
|-----------|-----|------|
| `rotation` | `number` | å›è»¢è§’åº¦EE, 90, 180, 270EE|

| æˆ»ã‚Šå€¤ | åE| èª¬æ˜E|
|--------|-----|------|
| - | `boolean` | æˆåŠŸãªã‚E`true` |

---

#### `rotateNext()`
æ¬¡ã®è§’åº¦ã«å›è»¢ã™ã‚‹ã€E

| æˆ»ã‚Šå€¤ | åE| èª¬æ˜E|
|--------|-----|------|
| - | `number` | æ–°ã—ã„å›è»¢è§’åº¦ |

---

#### `resetRotation()`
å›è»¢ã‚’ãƒªã‚»ãƒEƒˆEEåº¦ã«æˆ»ã™ï¼‰ã™ã‚‹ã€E

---

#### `removeRotationClasses(element)` (å†Eƒ¨é–¢æ•°)
å›è»¢ã‚¯ãƒ©ã‚¹ã‚’å‰Šé™¤ã™ã‚‹ã€E

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | åE| èª¬æ˜E|
|-----------|-----|------|
| `element` | `HTMLElement` | å¯¾è±¡è¦ç´  |

---

#### `calculateScale(video)` (å†Eƒ¨é–¢æ•°)
90åº¦/270åº¦å›è»¢æ™‚ãEã‚¹ã‚±ãƒ¼ãƒ«ã‚’è¨ˆç®—ã™ã‚‹ã€E

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | åE| èª¬æ˜E|
|-----------|-----|------|
| `video` | `HTMLVideoElement` | å‹•ç”»è¦ç´  |

| æˆ»ã‚Šå€¤ | åE| èª¬æ˜E|
|--------|-----|------|
| - | `number` | ã‚¹ã‚±ãƒ¼ãƒ«å€¤Eˆãƒ‡ãƒ•ã‚©ãƒ«ãƒE 0.5625 = 9/16EE|

---

#### `handleFullscreenChange()`
ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³å¤‰æ›´æ™‚ãEå›è»¢å†é©ç”¨ã€E

100mséE»¶å¾Œã«ç¾åœ¨ã®å›è»¢ã‚’åEé©ç”¨ã™ã‚‹ã€E

---

#### `initRotation(initialRotation)`
å›è»¢çŠ¶æ…‹ã‚’åˆæœŸåŒ–ã™ã‚‹ã€E

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | åE| ãƒEƒ•ã‚©ãƒ«ãƒE| èª¬æ˜E|
|-----------|-----|-----------|------|
| `initialRotation` | `number` | `0` | åˆæœŸå›è»¢è§’åº¦ |

---

## content/overlay-ui.js

å‹•ç”»ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ä¸Šã«ã‚ªãƒ¼ãƒãEãƒ¬ã‚¤ãƒœã‚¿ãƒ³ã‚’æ³¨å…¥ã™ã‚‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã€E

#### `createRotateButton()` (å†Eƒ¨é–¢æ•°)
å›è»¢ãƒœã‚¿ãƒ³ã‚’ä½œæEã™ã‚‹ã€E

| æˆ»ã‚Šå€¤ | åE| èª¬æ˜E|
|--------|-----|------|
| - | `HTMLButtonElement` | ãƒœã‚¿ãƒ³è¦ç´  |

---

#### `handleRotateClick()` (å†Eƒ¨é–¢æ•°)
å›è»¢ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒE‚¯ãƒãƒ³ãƒ‰ãƒ©ã€E

---

#### `handleResetClick()` (å†Eƒ¨é–¢æ•°)
ãƒªã‚»ãƒEƒˆã‚¯ãƒªãƒE‚¯ãƒãƒ³ãƒ‰ãƒ©Eˆãƒ€ãƒ–ãƒ«ã‚¯ãƒªãƒE‚¯æ™‚ï¼‰ã€E

---

#### `updateButtonState(rotation)`
ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹ã‚’æ›´æ–°ã™ã‚‹ã€E

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | åE| èª¬æ˜E|
|-----------|-----|------|
| `rotation` | `number` | å›è»¢è§’åº¦ |

---

#### `injectOverlayUI()`
ã‚ªãƒ¼ãƒãEãƒ¬ã‚¤UIã‚’æ³¨å…¥ã™ã‚‹ã€E

| æˆ»ã‚Šå€¤ | åE| èª¬æ˜E|
|--------|-----|------|
| - | `boolean` | æˆåŠŸãªã‚E`true` |

---

#### `removeOverlayUI()`
ã‚ªãƒ¼ãƒãEãƒ¬ã‚¤UIã‚’å‰Šé™¤ã™ã‚‹ã€E

---

#### `isOverlayUIInjected()`
ã‚ªãƒ¼ãƒãEãƒ¬ã‚¤UIãŒå­˜åœ¨ã™ã‚‹ã‹ãƒã‚§ãƒE‚¯ã™ã‚‹ã€E

| æˆ»ã‚Šå€¤ | åE| èª¬æ˜E|
|--------|-----|------|
| - | `boolean` | å­˜åœ¨ã™ã‚Œã° `true` |

---

#### `syncButtonState(rotation)`
å›è»¢è§’åº¦ã§ãƒœã‚¿ãƒ³çŠ¶æ…‹ã‚’æ›´æ–°ã™ã‚‹Eˆå¤–éƒ¨å‘¼ã³å‡ºã—ç”¨E‰ã€E

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | åE| èª¬æ˜E|
|-----------|-----|------|
| `rotation` | `number` | å›è»¢è§’åº¦ |

---

## background/service-worker.js

ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ãƒ¯ãƒ¼ã‚«ãƒ¼ã€‚ãƒ¡ãƒE‚»ãƒ¼ã‚¸ãƒ³ã‚°å‡¦çE¨è¨­å®šç®¡çE‚’æ‹E½“ã€E

#### `handleMessage(message)` (å†Eƒ¨é–¢æ•°)
ãƒ¡ãƒE‚»ãƒ¼ã‚¸ã‚’åEçE™ã‚‹ã€E

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | åE| èª¬æ˜E|
|-----------|-----|------|
| `message` | `object` | ãƒ¡ãƒE‚»ãƒ¼ã‚¸ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼Eype, payloadEE|

| æˆ»ã‚Šå€¤ | åE| èª¬æ˜E|
|--------|-----|------|
| - | `Promise<object>` | ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒE|

å¯¾å¿œãƒ¡ãƒE‚»ãƒ¼ã‚¸ã‚¿ã‚¤ãƒE
- `GET_SETTINGS`: è¨­å®šã‚’å–å¾E
- `UPDATE_SETTINGS`: è¨­å®šã‚’æ›´æ–°
- `GET_ROTATION`: å‹•ç”»ã®å›è»¢è¨­å®šã‚’å–å¾E
- `SAVE_ROTATION`: å‹•ç”»ã®å›è»¢è¨­å®šã‚’ä¿å­E
- `CLEAR_ALL_ROTATIONS`: ã™ã¹ã¦ã®å›è»¢è¨­å®šã‚’å‰Šé™¤

---

#### `handleGetSettings()` (å†Eƒ¨é–¢æ•°)
è¨­å®šã‚’å–å¾—ã™ã‚‹ã€E

| æˆ»ã‚Šå€¤ | åE| èª¬æ˜E|
|--------|-----|------|
| - | `Promise<object>` | `{ success: boolean, data?: object, error?: object }` |

---

#### `handleUpdateSettings(payload)` (å†Eƒ¨é–¢æ•°)
è¨­å®šã‚’æ›´æ–°ã™ã‚‹ã€E

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | åE| èª¬æ˜E|
|-----------|-----|------|
| `payload` | `object` | æ›´æ–°ã™ã‚‹è¨­å®E|

| æˆ»ã‚Šå€¤ | åE| èª¬æ˜E|
|--------|-----|------|
| - | `Promise<object>` | `{ success: boolean, error?: object }` |

---

#### `handleGetRotation(payload)` (å†Eƒ¨é–¢æ•°)
å‹•ç”»ã®å›è»¢è¨­å®šã‚’å–å¾—ã™ã‚‹ã€E

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | åE| èª¬æ˜E|
|-----------|-----|------|
| `payload` | `object` | `{ videoId: string }` |

| æˆ»ã‚Šå€¤ | åE| èª¬æ˜E|
|--------|-----|------|
| - | `Promise<object>` | `{ success: boolean, data?: object, error?: object }` |

---

#### `handleSaveRotation(payload)` (å†Eƒ¨é–¢æ•°)
å‹•ç”»ã®å›è»¢è¨­å®šã‚’ä¿å­˜ã™ã‚‹ã€E

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | åE| èª¬æ˜E|
|-----------|-----|------|
| `payload` | `object` | `{ videoId: string, rotation: number }` |

| æˆ»ã‚Šå€¤ | åE| èª¬æ˜E|
|--------|-----|------|
| - | `Promise<object>` | `{ success: boolean, error?: object }` |

---

#### `handleClearAllRotations()` (å†Eƒ¨é–¢æ•°)
ã™ã¹ã¦ã®å›è»¢è¨­å®šã‚’å‰Šé™¤ã™ã‚‹ã€E

| æˆ»ã‚Šå€¤ | åE| èª¬æ˜E|
|--------|-----|------|
| - | `Promise<object>` | `{ success: boolean, data?: { deletedCount: number }, error?: object }` |

---

## storage/settings-manager.js

Chrome Storage APIã‚’ä½¿ç”¨ã—ãŸè¨­å®šç®¡çEƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã€E

#### `getSettings()`
è¨­å®šã‚’å–å¾—ã™ã‚‹ã€E

| æˆ»ã‚Šå€¤ | åE| èª¬æ˜E|
|--------|-----|------|
| - | `Promise<object>` | è¨­å®šã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¨ãƒãEã‚¸æ¸ˆã¿EE|

---

#### `updateSettings(updates)`
è¨­å®šã‚’æ›´æ–°ã™ã‚‹ã€E

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | åE| èª¬æ˜E|
|-----------|-----|------|
| `updates` | `object` | æ›´æ–°ã™ã‚‹è¨­å®E|

| æˆ»ã‚Šå€¤ | åE| èª¬æ˜E|
|--------|-----|------|
| - | `Promise<void>` | - |

---

#### `getVideoRotation(videoId)`
å‹•ç”»ã®å›è»¢è¨­å®šã‚’å–å¾—ã™ã‚‹ã€E

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | åE| èª¬æ˜E|
|-----------|-----|------|
| `videoId` | `string` | YouTubeå‹•ç”»ID |

| æˆ»ã‚Šå€¤ | åE| èª¬æ˜E|
|--------|-----|------|
| - | `Promise<object\|null>` | `{ rotation: number, savedAt: number }` ã¾ãŸãE `null` |

---

#### `saveVideoRotation(videoId, rotation)`
å‹•ç”»ã®å›è»¢è¨­å®šã‚’ä¿å­˜ã™ã‚‹ã€E

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | åE| èª¬æ˜E|
|-----------|-----|------|
| `videoId` | `string` | YouTubeå‹•ç”»ID |
| `rotation` | `number` | å›è»¢è§’åº¦EE, 90, 180, 270EE|

| æˆ»ã‚Šå€¤ | åE| èª¬æ˜E|
|--------|-----|------|
| - | `Promise<void>` | - |

| ä¾‹å¤E| èª¬æ˜E|
|------|------|
| `Error` | videoIdã¾ãŸãErotationãŒç„¡åŠ¹ãªå ´åE|

---

#### `deleteVideoRotation(videoId)`
å‹•ç”»ã®å›è»¢è¨­å®šã‚’å‰Šé™¤ã™ã‚‹ã€E

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | åE| èª¬æ˜E|
|-----------|-----|------|
| `videoId` | `string` | YouTubeå‹•ç”»ID |

| æˆ»ã‚Šå€¤ | åE| èª¬æ˜E|
|--------|-----|------|
| - | `Promise<void>` | - |

---

#### `clearAllVideoRotations()`
ã™ã¹ã¦ã®å‹•ç”»å›è»¢è¨­å®šã‚’å‰Šé™¤ã™ã‚‹ã€E

| æˆ»ã‚Šå€¤ | åE| èª¬æ˜E|
|--------|-----|------|
| - | `Promise<number>` | å‰Šé™¤ã—ãŸä»¶æ•° |

---

#### `getAllStorage()`
ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®å…¨ãƒEEã‚¿ã‚’å–å¾—ã™ã‚‹ï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨E‰ã€E

| æˆ»ã‚Šå€¤ | åE| èª¬æ˜E|
|--------|-----|------|
| - | `Promise<object>` | å…¨ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒEEã‚¿ |

---

## utils/constants.js

å›è»¢è§’åº¦ã¨ãƒ›ãƒƒãƒˆã‚­ãƒ¼ãƒ—ãƒªã‚»ãƒEƒˆã®å®šç¾©ã€E

### å®šæ•°

| å®šæ•°åE| åE| å€¤ | èª¬æ˜E|
|--------|-----|-----|------|
| `ROTATION_ANGLES` | `number[]` | `[0, 90, 180, 270]` | æœ‰åŠ¹ãªå›è»¢è§’åº¦ |
| `DEFAULT_ROTATION` | `number` | `0` | ãƒEƒ•ã‚©ãƒ«ãƒˆå›è»¢è§’åº¦ |
| `DEFAULT_HOTKEY_PRESET` | `string` | `'default'` | ãƒEƒ•ã‚©ãƒ«ãƒˆãEãƒ›ãƒƒãƒˆã‚­ãƒ¼ãƒ—ãƒªã‚»ãƒEƒˆ |

### `HOTKEY_PRESETS`

| ãƒ—ãƒªã‚»ãƒEƒˆID | ã‚­ãƒ¼ | ä¿®é£¾ã‚­ãƒ¼ | èª¬æ˜E|
|-------------|------|---------|------|
| `default` | `r` | ãªãE| Rã‚­ãƒ¼ã®ã¿ |
| `alt` | `r` | Alt | Alt + R |
| `ctrl` | `r` | Ctrl + Shift | Ctrl + Shift + R |

### `STORAGE_KEYS`

| ã‚­ãƒ¼ | å€¤ | èª¬æ˜E|
|-----|-----|------|
| `SETTINGS` | `'settings'` | è¨­å®šãEã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚­ãƒ¼ |
| `VIDEO_ROTATIONS` | `'videoRotations'` | å‹•ç”»å›è»¢ã®ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚­ãƒ¼ |

### `BUTTON_POSITIONS`

| ã‚­ãƒ¼ | å€¤ | èª¬æ˜E|
|-----|-----|------|
| `overlay` | `'overlay'` | ã‚ªãƒ¼ãƒãEãƒ¬ã‚¤Eˆå‹•ç”»å·¦ä¸Šï¼E|
| `controlbar` | `'controlbar'` | ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒãE |

### `DEFAULT_SETTINGS`

| ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ | ãƒEƒ•ã‚©ãƒ«ãƒˆå€¤ | èª¬æ˜E|
|-----------|-------------|------|
| `hotkeyPreset` | `'default'` | ã‚­ãƒ¼ãƒœãEãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒEƒˆ |
| `rememberRotation` | `true` | å›è»¢ã‚’è¨˜æEã™ã‚‹ãE|
| `defaultRotation` | `0` | ãƒEƒ•ã‚©ãƒ«ãƒˆå›è»¢è§’åº¦ |
| `resetOnVideoChange` | `true` | å‹•ç”»åˆE‚Šæ›¿ãˆæ™‚ã«ãƒªã‚»ãƒEƒˆ |
| `buttonPosition` | `'overlay'` | ãƒœã‚¿ãƒ³è¡¨ç¤ºä½ç½® |
| `autoDetectRotation` | `false` | è‡ªå‹•å›è»¢æ¤œåEEˆå®Ÿé¨“æ©ŸèEEE|
| `detectionMethod` | `'face'` | æ¤œåEæ–¹æ³•ï¼Eace: é¡”æ¤œåE, ai: AIåˆ¤å®šï¼E|

### `MESSAGE_TYPES`

| ã‚­ãƒ¼ | å€¤ | èª¬æ˜E|
|-----|-----|------|
| `GET_SETTINGS` | `'GET_SETTINGS'` | è¨­å®šå–å¾E|
| `UPDATE_SETTINGS` | `'UPDATE_SETTINGS'` | è¨­å®šæ›´æ–° |
| `SAVE_ROTATION` | `'SAVE_ROTATION'` | å›è»¢ä¿å­E|
| `GET_ROTATION` | `'GET_ROTATION'` | å›è»¢å–å¾E|
| `CLEAR_ALL_ROTATIONS` | `'CLEAR_ALL_ROTATIONS'` | å…¨å›è»¢å‰Šé™¤ |

### é–¢æ•°

#### `getNextRotation(currentRotation)`
æ¬¡ã®å›è»¢è§’åº¦ã‚’è¨ˆç®—ã™ã‚‹ã€E

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | åE| èª¬æ˜E|
|-----------|-----|------|
| `currentRotation` | `number` | ç¾åœ¨ã®å›è»¢è§’åº¦ |

| æˆ»ã‚Šå€¤ | åE| èª¬æ˜E|
|--------|-----|------|
| - | `number` | æ¬¡ã®å›è»¢è§’åº¦ |

---

#### `isValidRotation(rotation)`
å›è»¢è§’åº¦ãŒæœ‰åŠ¹ã‹ãƒã‚§ãƒE‚¯ã™ã‚‹ã€E

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | åE| èª¬æ˜E|
|-----------|-----|------|
| `rotation` | `number` | ãƒã‚§ãƒE‚¯ã™ã‚‹è§’åº¦ |

| æˆ»ã‚Šå€¤ | åE| èª¬æ˜E|
|--------|-----|------|
| - | `boolean` | æœ‰åŠ¹ãªã‚E`true` |

---

## utils/youtube-selectors.js

YouTubeã®DOMã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼å®šç¾©ã€E

### `YOUTUBE_SELECTORS`

| ã‚­ãƒ¼ | ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ | èª¬æ˜E|
|-----|-----------|------|
| `player` | `#movie_player` | ãƒ¡ã‚¤ãƒ³å‹•ç”»ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ |
| `videoContainer` | `.html5-video-container` | å‹•ç”»ã‚³ãƒ³ãƒEƒŠEˆå›è»¢é©ç”¨å¯¾è±¡EE|
| `video` | `video.html5-main-video` | å‹•ç”»è¦ç´  |
| `controls` | `.ytp-chrome-bottom` | ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« |
| `fullscreenButton` | `.ytp-fullscreen-button` | ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãƒœã‚¿ãƒ³ |
| `playerWrapper` | `#player-container-outer` | ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ãƒ©ãƒEƒ‘ãƒ¼ |

### `SUPPORTED_SITES.youtube`

YouTubeã‚µã‚¤ãƒˆãEå®šç¾©ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã€E

| ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ | åE| èª¬æ˜E|
|-----------|-----|------|
| `id` | `string` | `'youtube'` |
| `name` | `string` | `'YouTube'` |
| `hostPattern` | `string` | `'*://*.youtube.com/*'` |
| `hostRegex` | `RegExp` | `/^https?:\/\/(www\.)?youtube\.com/` |
| `selectors` | `object` | `YOUTUBE_SELECTORS` |

#### `SUPPORTED_SITES.youtube.extractVideoId(url)`
URLã‹ã‚‰YouTubeå‹•ç”»IDã‚’æŠ½å‡ºã™ã‚‹ã€E

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | åE| èª¬æ˜E|
|-----------|-----|------|
| `url` | `string` | ãƒšãEã‚¸URL |

| æˆ»ã‚Šå€¤ | åE| èª¬æ˜E|
|--------|-----|------|
| - | `string\|null` | å‹•ç”»ID ã¾ãŸãE `null` |

### é–¢æ•°

#### `getSupportedSite(url)`
ç¾åœ¨ã®ã‚µã‚¤ãƒˆãŒå¯¾å¿œã‚µã‚¤ãƒˆã‹ãƒã‚§ãƒE‚¯ã™ã‚‹ã€E

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | åE| èª¬æ˜E|
|-----------|-----|------|
| `url` | `string` | ãƒã‚§ãƒE‚¯ã™ã‚‹URL |

| æˆ»ã‚Šå€¤ | åE| èª¬æ˜E|
|--------|-----|------|
| - | `object\|null` | å¯¾å¿œã‚µã‚¤ãƒˆå®šç¾© ã¾ãŸãE `null` |

---

#### `isYouTube()`
ç¾åœ¨ã®ãƒšãEã‚¸ãŒYouTubeã‹ãƒã‚§ãƒE‚¯ã™ã‚‹ã€E

| æˆ»ã‚Šå€¤ | åE| èª¬æ˜E|
|--------|-----|------|
| - | `boolean` | YouTubeãªã‚E`true` |

---

## popup/popup.js

ãƒãƒƒãƒ—ã‚¢ãƒEEãƒšãEã‚¸ã®ãƒ­ã‚¸ãƒE‚¯ã€E

#### `initialize()`
åˆæœŸåŒ–ã™ã‚‹ã€E

| æˆ»ã‚Šå€¤ | åE| èª¬æ˜E|
|--------|-----|------|
| - | `Promise<void>` | - |

å‡¦çEEå®¹:
1. ç¾åœ¨ã®ã‚¿ãƒ–ã‚’å–å¾E
2. ã‚µã‚¤ãƒˆæƒ…å ±ã‚’è¡¨ç¤º
3. è¨­å®šã‚’èª­ã¿è¾¼ã‚€
4. ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãEã‚’è¨­å®E

---

#### `updateSiteInfo(url)`
ã‚µã‚¤ãƒˆæƒ…å ±ã‚’æ›´æ–°ã™ã‚‹ã€E

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | åE| èª¬æ˜E|
|-----------|-----|------|
| `url` | `string` | ç¾åœ¨ã®ã‚¿ãƒ–URL |

---

#### `showUnsupportedMessage()`
æœªå¯¾å¿œã‚µã‚¤ãƒˆãƒ¡ãƒE‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã™ã‚‹ã€E

---

#### `loadSettings()`
è¨­å®šã‚’èª­ã¿è¾¼ã‚€ã€E

| æˆ»ã‚Šå€¤ | åE| èª¬æ˜E|
|--------|-----|------|
| - | `Promise<void>` | - |

---

#### `updateHotkeyHint(presetId)`
ãƒ›ãƒƒãƒˆã‚­ãƒ¼ãƒ’ãƒ³ãƒˆã‚’æ›´æ–°ã™ã‚‹ã€E

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | åE| èª¬æ˜E|
|-----------|-----|------|
| `presetId` | `string` | ãƒ—ãƒªã‚»ãƒEƒˆID |

---

#### `setupEventListeners()`
ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãEã‚’è¨­å®šã™ã‚‹ã€E

---

#### `setRotation(rotation)`
å›è»¢ã‚’è¨­å®šã™ã‚‹ã€E

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | åE| èª¬æ˜E|
|-----------|-----|------|
| `rotation` | `number` | å›è»¢è§’åº¦ |

| æˆ»ã‚Šå€¤ | åE| èª¬æ˜E|
|--------|-----|------|
| - | `Promise<void>` | - |

Content Scriptã« `SET_ROTATION` ãƒ¡ãƒE‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã™ã‚‹ã€E

---

#### `updateRotationUI(rotation)`
å›è»¢UIã‚’æ›´æ–°ã™ã‚‹ã€E

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | åE| èª¬æ˜E|
|-----------|-----|------|
| `rotation` | `number` | å›è»¢è§’åº¦ |

---

## options/options.js

è¨­å®šãEãƒ¼ã‚¸ã®ãƒ­ã‚¸ãƒE‚¯ã€E

#### `initialize()`
åˆæœŸåŒ–ã™ã‚‹ã€E

| æˆ»ã‚Šå€¤ | åE| èª¬æ˜E|
|--------|-----|------|
| - | `Promise<void>` | - |

å‡¦çEEå®¹:
1. ç¾åœ¨ã®è¨­å®šã‚’èª­ã¿è¾¼ã‚€
2. ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãEã‚’è¨­å®E

---

#### `loadSettings()`
è¨­å®šã‚’èª­ã¿è¾¼ã‚€ã€E

| æˆ»ã‚Šå€¤ | åE| èª¬æ˜E|
|--------|-----|------|
| - | `Promise<void>` | - |

---

#### `setupEventListeners()`
ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãEã‚’è¨­å®šã™ã‚‹ã€E

ç›£è¦–ã™ã‚‹è¦ç´ :
- ãƒœã‚¿ãƒ³è¡¨ç¤ºä½ç½®é¸æŠE
- ãƒ›ãƒƒãƒˆã‚­ãƒ¼ãƒ—ãƒªã‚»ãƒEƒˆé¸æŠE
- å‹•ç”»åˆE‚Šæ›¿ãˆæ™‚ãƒªã‚»ãƒEƒˆãƒã‚§ãƒE‚¯ãƒœãƒƒã‚¯ã‚¹
- å›è»¢è¨˜æEãƒã‚§ãƒE‚¯ãƒœãƒƒã‚¯ã‚¹
- ãƒEƒ•ã‚©ãƒ«ãƒˆå›è»¢é¸æŠE
- å›è»¢è¨­å®šã‚¯ãƒªã‚¢ãƒœã‚¿ãƒ³

---

#### `saveSettings(updates)`
è¨­å®šã‚’ä¿å­˜ã™ã‚‹ã€E

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | åE| èª¬æ˜E|
|-----------|-----|------|
| `updates` | `object` | æ›´æ–°ã™ã‚‹è¨­å®E|

| æˆ»ã‚Šå€¤ | åE| èª¬æ˜E|
|--------|-----|------|
| - | `Promise<void>` | - |

---

#### `clearAllRotations()`
ã™ã¹ã¦ã®å›è»¢è¨­å®šã‚’ã‚¯ãƒªã‚¢ã™ã‚‹ã€E

| æˆ»ã‚Šå€¤ | åE| èª¬æ˜E|
|--------|-----|------|
| - | `Promise<void>` | - |

---

#### `showSaveNotification()`
ä¿å­˜é€šçŸ¥ã‚’è¡¨ç¤ºã™ã‚‹ã€E

2ç§’å¾Œã«è‡ªå‹•ã§éè¡¨ç¤ºã«ãªã‚‹ã€E
